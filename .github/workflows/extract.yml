name: Extract and Overwrite Kernel
on: 
  push:
    branches:
      - master  # Ganti ke nama branch kamu jika bukan main
  workflow_dispatch: # Agar bisa dijalankan manual dari tab Actions

jobs:
  process-kernel:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          # Menggunakan token otomatis GitHub (lebih aman)
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Checkout LFS objects
        run: git lfs checkout

      - name: Extract Kernel.tar.gz
        run: |
          echo "Mengekstrak base kernel..."
          tar -xzf Kernel.tar.gz

      - name: Extract Zip and Overwrite
        run: |
          echo "Mengekstrak source update..."
          unzip -o SM-A035F_13_Opensource_A035FXXS9CYG1.zip
          
          # Logika menimpa: Masuk ke folder Kernel hasil unzip, 
          # lalu pindahkan semua isinya ke root directory.
          if [ -d "Kernel" ]; then
            cp -rf Kernel/* .
            echo "File telah ditimpa dengan isi dari folder Kernel (zip)."
          fi

      - name: Final Cleanup
        run: |
          echo "Membersihkan file yang tidak diperlukan..."
          # Hapus file README_Kernel.txt jika ada di root
          rm -f README_Kernel.txt
          
          # Hapus 3 file utama yang diminta
          rm -f .gitattributes
          rm -f Kernel.tar.gz
          rm -f SM-A035F_13_Opensource_A035FXXS9CYG1.zip
          
          # Hapus folder temporary Kernel (hasil unzip zip tadi)
          rm -rf Kernel
          
          echo "Pembersihan selesai."

      - name: Commit and Push Changes
        run: |
          git config --global user.name "Skyzers-XZ"
          git config --global user.email "muchamadrizal0216@email.com"
          
          git add .
          # Cek jika ada perubahan sebelum commit agar tidak error
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "first commit"
            git push
          else
            echo "Tidak ada perubahan untuk di-push."
          fi
